<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui"
	xmlns:es="http://essearch.fr/taglibs">

<h:head>
	<link rel="stylesheet" type="text/css" media="all" />
	<title>Es Search</title>
	<link rel="shortcut icon" type="image/x-icon" href="./img/logo.png" />
</h:head>

<p:growl id="messages" showDetail="true" life="1000" />

<h:form id="formlogin" enctype="multipart/form-data">
	
	<p:toolbar id="menu">
   		<p:toolbarGroup align="left" rendered="#{userController.logged}">
   			<p:commandButton type="push" value="Add..." image="ui-icon-document" />
   		</p:toolbarGroup>
   		<p:toolbarGroup align="right" rendered="#{userController.logged}">
			<p:menuButton value="#{userController.username}">
				<p:menuitem icon="ui-icon-power" value="Logout" action="#{userController.logout}" update="menu,messages" />
			</p:menuButton> 
   		</p:toolbarGroup>
   		<p:toolbarGroup align="right" rendered="#{!userController.logged}">
   			<p:commandButton id="loginLink" type="push" value="Login..." image="ui-icon-power" onclick="login.show();" />
   		</p:toolbarGroup>
	</p:toolbar>


	<center>
		<h:panelGrid>
			<f:facet name="header">
		  		<h:graphicImage value="./img/logo-text.png" />
			</f:facet>
			<p:inputText value="#{searchController.search}" size="100" />
			<f:facet name="footer">
				<center>
				<h:panelGrid columns="2">
					<p:commandButton value="Search" update="results"
						action="#{searchController.google}" />
					<p:commandButton value="I'm lucky" action="#{searchController.imlucky}" />
				</h:panelGrid>
				</center>
			</f:facet>
		</h:panelGrid>
	</center>



	<center>

	<es:results results="#{searchController.results}" />
	
	</center>

	<p:dialog header="Upload your documents" widgetVar="upload" showEffect="explode"
		modal="true" hideEffect="explode" height="300" width="500">
		<p:fileUpload
			fileUploadListener="#{fileUploadController.handleFileUpload}"
			mode="advanced" update="messages" multiple="true" />
	</p:dialog>

	<p:dialog header="Login" widgetVar="login" id="loginDialog" showEffect="explode"
		modal="true" hideEffect="explode" height="300" width="500">
		<p:inputText value="#{userController.username}" size="20" />
		<p:password value="#{userController.password}" size="20" feedback="false" />
		<p:commandButton value="Login" update="menu,messages"
			actionListener="#{userController.login}"
			oncomplete="handleLoginRequest(xhr, status, args)" />
	</p:dialog>

</h:form>

<script type="text/javascript">  
    function handleLoginRequest(xhr, status, args) {  
        if(args.validationFailed || !args.logged) {  
            jQuery('#loginDialog').effect("shake", { times:3 }, 100);  
        } else {   
        	login.hide();  
            jQuery('#loginLink').fadeOut();  
        }  
    }  
</script>


<h:body>


</h:body>
</html>